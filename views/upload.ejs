<% include ./partials/header.ejs %>
  <div class="w-full min-h-screen bg-white dark:bg-zinc-900  md:w-[40vw] md:mx-auto text-zinc-900 dark:text-white py-5">
    <div class="flex justify-between items-center px-4">
      <a class="text-sm text-blue-500" href="/profile"><i class="ri-arrow-left-s-line"></i> profile</a>
      <h2 class="leading-none text-sm">Upload Post</h2>
      <a class="text-sm" href="/feed"><i class="ri-home-line"></i> home</a>
    </div>
    <div class="flex flex-col items-center gap-2 mt-20">
      <div class="image w-[25vw] h-[25vw] md:w-[10vw] md:h-[10vw] rounded-full border-2 border-zinc-800 flex items-center justify-center">
        <!-- Image preview will be inserted here -->
        <img id="preview" class="hidden w-full h-full object-cover rounded-full" />
        <i id="imageIcon" class="text-3xl font-light ri-image-line"></i>
      </div>
      <button id="selectpic" class="text-blue-500 capitalize">select picture</button>
    </div>
    <div class="flex btngrp justify-center gap-5 mt-10">
      <button class="selected btn border-b-2 pb-2 border-zinc-400">post</button>
      <button class="opacity-30 btn border-b-2 border-zinc-900 pb-2">story</button>
      <button class="opacity-30 btn border-b-2 border-zinc-900 pb-2">reel</button>
    </div>
    <form id="uploadform" action="/upload" class="w-full px-6 py-3 mt-10" enctype="multipart/form-data" method="post">
      <input hidden type="file" name="image" id="fileInput">
      <input hidden type="radio" name="type" value="post" checked>
      <textarea name="caption" class="px-2 py-1 w-full bg-white dark:bg-zinc-900 border-2 h-20 border-zinc-800 resize-none rounded-md outline-none"
        placeholder="Write a caption..."></textarea>
      <input class="w-full px-2 py-2 bg-blue-500 rounded-md" type="submit" value="Post">
    </form>
  </div>

  <script>
    // Event listener for the 'select picture' button
    document.querySelector("#selectpic")
      .addEventListener("click", function () {
        document.querySelector("#fileInput").click();
      });

    // Event listener for image input change to display the preview
    document.querySelector("#fileInput").addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          // Hide the icon and show the image preview
          document.querySelector("#imageIcon").classList.add("hidden");
          const preview = document.querySelector("#preview");
          preview.src = e.target.result;
          preview.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    });

    // Function to switch between Post, Story, and Reel
    function handleSwitchTypePost() {
      document.querySelector(".btngrp")
        .addEventListener("click", function (ev) {
          if (ev.target.classList.contains('btn')) {
            if (!ev.target.classList.contains("selected")) {
              document.querySelector("#uploadform input[type='radio']")
                .value = ev.target.textContent;

              var selected = ev.target.parentNode.querySelector(".selected");
              selected.classList.remove('selected', 'border-zinc-400');
              selected.classList.add('opacity-30', 'border-zinc-900');

              ev.target.classList.add('selected', 'border-zinc-400');
              ev.target.classList.remove('opacity-30', 'border-zinc-900');
            }
          }
        });
    }
    handleSwitchTypePost();
  </script>
<% include ./partials/footer.ejs %>
